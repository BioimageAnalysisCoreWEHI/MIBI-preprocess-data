---
title: MIBI data preprocessing summary report
date: now
format:
  html:
    number-sections: true
    embed-resources: true
    theme: cosmo
    page-layout: full
    toc: true
    toc-location: left
    code-fold: true
    code-tools: true
---

```{python}
#| tags: [parameters]
batch_name = ""
output_folder = "output"
unwanted_celltypes = ""
qupath_data = ""
additional_metadata_to_keep = ""
unwanted_celltypes = ""
change_unwanted_celltypes_to = "Other"
unwanted_markers = ""
unwanted_compartments = ""
unwanted_statistics = ""
target = ""
```

```{python}
#| label: process-args

def validate_arg(arg, argname):
    if not arg:
        raise RuntimeError(f"{argname} parameter needs to be defined")

validate_arg(batch_name, "batch_name")
validate_arg(output_folder, "output_folder")
validate_arg(qupath_data, "qupath_data")

valid_target = ["main-cell-type", "fm-markers-only", "fm-with-celltypes"]
if (not target) or target not in valid_target:
    raise RuntimeError(f"target must either one of {valid_target}")

if unwanted_celltypes:
    cell_types_to_remove = [s.strip() for s in unwanted_celltypes.split(",")]
if additional_metadata_to_keep:
    additional_meta_data_to_keep = [s.strip() for s in additional_metadata_to_keep.split(",")]
if unwanted_markers:
    unwanted_markers = [s.strip() for s in unwanted_markers.split(",")]
if unwanted_compartments:
    unwanted_compartments = [s.strip() for s in unwanted_compartments.split(",")]
if unwanted_statistics:
    unwanted_statistics = [s.strip() for s in unwanted_statistics.split(",")]
```